# Konfigurationsdatei für Apache - Vertragsverwaltungssystem
# Arquivo de configuração Apache - Sistema de Gerenciamento de Contratos
#
# Diese Datei wird automatisch vom deploy-internal.sh Script verwendet
# Este arquivo é usado automaticamente pelo script deploy-internal.sh

<VirtualHost *:80>
    # Server-Name für interne Nutzung / Server name para uso interno
    ServerName vertrag-mgs.empresa.local
    ServerAlias vertrag-mgs.local
    
    # Dokument-Root für Frontend-Dateien / Document root para arquivos frontend  
    DocumentRoot /var/www/html/vertrag-mgs
    
    # Verzeichnisberechtigungen / Permissões de diretório
    <Directory "/var/www/html/vertrag-mgs">
        AllowOverride All
        Require all granted
        DirectoryIndex index.html
        
        # Fallback für SPA (Single Page Application) / Fallback para SPA
        <IfModule mod_rewrite.c>
            RewriteEngine On
            RewriteBase /
            RewriteRule ^index\.html$ - [L]
            RewriteCond %{REQUEST_FILENAME} !-f
            RewriteCond %{REQUEST_FILENAME} !-d
            RewriteRule . /index.html [L]
        </IfModule>
    </Directory>
    
    # API Proxy-Konfiguration / Configuração proxy para API
    # Alle /api/* Anfragen an FastAPI weiterleiten / Redirecionar todas as chamadas /api/* para FastAPI
    <Location "/api/">
        ProxyPass "http://127.0.0.1:8000/"
        ProxyPassReverse "http://127.0.0.1:8000/"
        ProxyPreserveHost On
        
        # Headers für API / Headers para API
        ProxyPassReverse /
        ProxyPassReverseRewrite Off
    </Location>
    
    # WebSocket Support (falls benötigt) / Suporte WebSocket (se necessário)
    <Location "/ws/">
        ProxyPass "ws://127.0.0.1:8000/ws/"
        ProxyPassReverse "ws://127.0.0.1:8000/ws/"
    </Location>
    
    # Statische Assets mit Caching / Assets estáticos com cache
    <LocationMatch "\.(css|js|png|jpg|jpeg|gif|ico|svg)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 month"
        Header append Cache-Control "public"
    </LocationMatch>
    
    # Security Headers / Headers de segurança
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    
    # CORS für interne API / CORS para API interna
    <Location "/api/">
        Header add Access-Control-Allow-Origin "*"
        Header add Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Header add Access-Control-Allow-Headers "Content-Type, Authorization"
    </Location>
    
    # Logs / Logs
    LogLevel warn
    ErrorLog ${APACHE_LOG_DIR}/vertrag-mgs-error.log
    CustomLog ${APACHE_LOG_DIR}/vertrag-mgs-access.log combined
    
    # Komprimierung aktivieren / Ativar compressão
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/plain
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/xml
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE application/xml
        AddOutputFilterByType DEFLATE application/xhtml+xml
        AddOutputFilterByType DEFLATE application/rss+xml
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/x-javascript
    </IfModule>
</VirtualHost>

# Optional: HTTPS-Konfiguration für Produktionsumgebung
# Opcional: Configuração HTTPS para ambiente de produção
#
# <VirtualHost *:443>
#     ServerName vertrag-mgs.empresa.local
#     DocumentRoot /var/www/html/vertrag-mgs
#     
#     SSLEngine on
#     SSLCertificateFile /etc/ssl/certs/vertrag-mgs.crt
#     SSLCertificateKeyFile /etc/ssl/private/vertrag-mgs.key
#     
#     # Dieselben Konfigurationen wie oben / Mesmas configurações de cima
#     # ...
# </VirtualHost>